<html>
<head>
	<meta charset="UTF-8" />

</head>

<body>
	<input id="sendtext" type="text" />
	<input type="button" id="sendBtn" value="send" onclick="senddata()"></input>
	<div id='comms'></div>
	<canvas id="myCanvas" width="300" height="150" style="border:1px solid #d3d3d3;"></canvas>

	<script>

		function IsJsonString(str) {
			try {
				JSON.parse(str);
			} catch (e) {
				return false;
			}
			return true;
		}

		var serversocket = new WebSocket("ws://10.12.13.14:8080/echo");
		var c=document.getElementById("myCanvas");
		var ctx=c.getContext("2d");
		
		serversocket.onopen = function() {
			serversocket.send("DESKTOP");
		}


		function drawRotatedRect(x,y,width,height,degrees){
        ctx.save();

        ctx.beginPath();
        ctx.translate( x+width/2, y+height/2 );
        ctx.rotate(degrees*Math.PI/180);
        ctx.rect( -width/2, -height/2, width,height);

        ctx.fillStyle="gold";
        ctx.fill();
        ctx.restore();

    }

        // Write message on receive
        serversocket.onmessage = function(e) {
        	document.getElementById('comms').innerHTML = "Received: " + e.data + "<br>";
        	
        	if (IsJsonString(e.data)) {
        		document.getElementById("myCanvas").height = document.getElementById("myCanvas").height
        		var rot = JSON.parse(e.data);
        		
        		var x = document.getElementById("myCanvas").width / 2
        		var y = document.getElementById("myCanvas").height / 2
        		
        		drawRotatedRect(x, y, 100, 50, rot.beta);
        	}


        };

        function senddata() {
        	var data = document.getElementById('sendtext').value;
        	serversocket.send(data);
        	document.getElementById('comms').innerHTML += "Sent: " + data + "<br>";
        }

    </script>
</body>
</html>